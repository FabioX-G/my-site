<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>{% if title %}{{ title }} | {% endif %}{{ site.title or "Fabio Xie" }}</title>
  <meta name="description" content="{{ site.description or 'Fabio Xie — 经验、博客、书架' }}" />
  <meta name="theme-color" content="#0a0f2c" />

  {# 可选：SEO 扩展（如 canonical/OG），按需在各页面 head 插槽里传入 #}
  {% if head %}{{ head | safe }}{% endif %}

  <link rel="stylesheet" href="/assets/styles.css" />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='12' fill='%2300bcd4'/%3E%3C/svg%3E">
</head>

{# 仅保留一个控制类：reading（沉浸阅读模式） #}
<body class="{% if reading %}reading {% endif %}{% if home %}home{% endif %}">
  {# 无障碍：键盘直达主内容 #}
  <a class="skip-link" href="#content">Skip to content</a>

  {% if not reading %}
    {% include "nav.njk" %}
    <div class="layout">
      <main id="content" class="page" role="main" tabindex="-1">
        <div class="container {{ bodyClass | default('') }} ">
          {{ content | safe }}
        </div>
        <footer class="site-footer" role="contentinfo">
          <div class="container--footer">
            © {% year %} Fabio Xie
          </div>
        </footer>
      </main>
    </div>
  {% else %}
    <nav class="essay-nav" aria-label="Essay navigation">
      <a href="/essay/" class="essay-nav__back" title="Back to Essays">↺ Essays</a>
      <div class="essay-nav__links">
        {% if page.previous %}
          <a class="essay-nav__link essay-nav__prev" href="{{ page.previous.url }}" title="Previous essay">← {{ page.previous.data.title }}</a>
        {% endif %}
        {% if page.next %}
          <a class="essay-nav__link essay-nav__next" href="{{ page.next.url }}" title="Next essay">{{ page.next.data.title }} →</a>
        {% endif %}
      </div>
    </nav>
    <main id="content" class="site-main" role="main" tabindex="-1">
      <div class="container {{ bodyClass | default('') }} ">
        {{ content | safe }}
      </div>
    </main>
    <footer class="site-footer" role="contentinfo">
      <div class="container--footer">
        © {% year %} Fabio Xie
      </div>
    </footer>
  {% endif %}

  <script>
    (function(){
      const btn = document.querySelector('.nav-toggle');
      const overlay = document.getElementById('nav-overlay');
      const closeBtn = document.querySelector('.nav-close');
      const html = document.documentElement;
      if(!btn || !overlay) return;
      function open(){
        btn.setAttribute('aria-expanded','true');
        html.classList.add('menu-open');
        if(closeBtn){ closeBtn.focus(); }
      }
      function close(){
        btn.setAttribute('aria-expanded','false');
        html.classList.remove('menu-open');
        if(window.getComputedStyle(btn).display !== 'none'){
          btn.focus();
        }
      }
      btn.addEventListener('click', ()=> btn.getAttribute('aria-expanded')==='true' ? close() : open());
      if(closeBtn){
        closeBtn.addEventListener('click', close);
      }
      overlay.addEventListener('click', event => {
        if(event.target.closest('a')) close();
        if(event.target.classList.contains('nav-overlay')) close();
      });
      const mq = window.matchMedia('(max-width: 720px)');
      if(mq && mq.addEventListener){
        mq.addEventListener('change', e => { if(!e.matches) close(); });
      } else if(mq && mq.addListener){
        mq.addListener(e => { if(!e.matches) close(); });
      }
      window.addEventListener('keydown', e=>{ if(e.key==='Escape') close(); });
    })();
  </script>

</body>
</html>
