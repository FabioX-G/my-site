<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>{% if title %}{{ title }} | {% endif %}{{ site.title or "Fabio Xie" }}</title>
  <meta name="description" content="{{ site.description or 'Fabio Xie — 经验、博客、书架' }}" />
  <meta name="theme-color" content="#0a0f2c" />

  {# 可选：SEO 扩展（如 canonical/OG），按需在各页面 head 插槽里传入 #}
  {% if head %}{{ head | safe }}{% endif %}

  <link rel="stylesheet" href="/assets/styles.css" />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='12' fill='%2300bcd4'/%3E%3C/svg%3E">
</head>

{# 仅保留一个控制类：reading（沉浸阅读模式） #}
<body class="{% if reading %}reading {% endif %}{% if home %}home{% endif %}">
  {# 无障碍：键盘直达主内容 #}
  <a class="skip-link" href="#main-content">跳到主内容</a>

  {# ───────── 固定的启动器 + 侧栏（不参与页面竖向布局高度）───────── #}
  <div class="nav-launcher" aria-label="主导航">
    <!-- 悬浮启动按钮（小球） -->
    <button class="nav-fab" aria-controls="sidebar" aria-expanded="false" aria-label="打开主导航">
      <span class="dot" aria-hidden="true"></span>
    </button>

    <!-- 侧栏（固定于左侧，内部可滚动） -->
    <aside id="sidebar" class="sidebar" role="navigation" aria-label="站点导航">
      <div class="sidebar-content">
        <header class="sidebar-header">
          <a href="/" class="brand">Fabio Xie</a>
        </header>

        <nav class="nav" aria-label="主菜单">
          <a class="nav-link nav-about{% if page.url == '/about/' %} is-active{% endif %}" href="/about/">About Me</a>
          <a class="nav-link nav-blog{% if page.url == '/essay/' %} is-active{% endif %}" href="/essay/">Blog</a>
          <a class="nav-link nav-books{% if page.url == '/bookshelf/' %} is-active{% endif %}" href="/bookshelf/">Bookshelf</a>
          <a class="nav-link nav-quotes{% if page.url == '/quotes/' %} is-active{% endif %}" href="/quotes/">Quotes</a>
        </nav>
      </div>


    </aside>
  </div>

  {# ───────── 主内容区域（唯一的主容器）───────── #}
  <main  class="site-main" role="main" tabindex="-1">
    <div class="container {{ bodyClass | default('') }} ">
      {{ content | safe }}
    </div>
  </main>

  {# ───────── 站点页脚：贴底 + 居中（居中交给 CSS）───────── #}
  <footer class="site-footer" role="contentinfo">
    <div class="container--footer">
      © {% year %} Fabio Xie
    </div>
  </footer>

  {# ───────── 交互脚本：hover 展开 / click 切换 / Esc & 点击外部关闭 ───────── #}
  <script>
  (() => {
    const root = document.querySelector('.nav-launcher');
    if (!root) return;

    const fab = root.querySelector('.nav-fab');
    const sidebar = root.querySelector('.sidebar');

    let hideTimer = null;
    const open = () => {
      clearTimeout(hideTimer);
      root.classList.add('is-open');
      fab.setAttribute('aria-expanded', 'true');
    };
    const close = () => {
      clearTimeout(hideTimer);
      root.classList.remove('is-open');
      fab.setAttribute('aria-expanded', 'false');
    };
    const scheduleClose = (delay = 160) => {
      clearTimeout(hideTimer);
      hideTimer = setTimeout(close, delay);
    };

    // 桌面：悬停打开，移出 launcher 区域延时收起
    fab.addEventListener('mouseenter', open);
    sidebar.addEventListener('mouseenter', open);
    root.addEventListener('mouseleave', () => scheduleClose(160));

    // 点击小球切换（移动端/无悬停）
    fab.addEventListener('click', (e) => {
      e.preventDefault();
      root.classList.contains('is-open') ? close() : open();
    });

    // Esc 关闭
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') close(); });

    // 点击外部关闭
    document.addEventListener('click', (e) => {
      if (!root.classList.contains('is-open')) return;
      if (!e.target.closest('.nav-launcher')) close();
    });
  })();
  </script>
</body>
</html>